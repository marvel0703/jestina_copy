var Shop = {
    'mobilePrefix': '/sp'
};

/**
 * 모바일 페이지 여부 (디바이스 체크 아님)
 */
Shop.isMobilePage = (function() {
    if (location.href.indexOf(Shop.mobilePrefix) > -1) {
        return true;
    } else {
        return false;
    }
}());

Shop.url = function(url) {
    if (Shop.isMobilePage) {
        return Shop.mobilePrefix + url;
    }
    return url;
};

/**
 * 상품검색
 */
Shop.findItem = function(targetId) {
    Common.popup("/opmanager/item/find-item?targetId=" + targetId, 'find-item', 1000, 600, 1);
};

// 관련상품 추가
Shop.addRelationItem = function(id, item) {
    var key = id + '_item_' + item.itemId;
    var itemCount = $('#' + key).size();
    if (itemCount == 0) {
        if (typeof findItemCallback == 'function') {
            findItemCallback(id, item);
        } else {
            var ordering = $('input[name=' + id + 'ItemIds]').size() + 1;
            var html = '';
            if(id == 'displayAll' || id == 'displayJewelry' || id == 'displayBag' || id == 'displayWatch'
                || id == 'displayOutlet' || id == 'displayExclusive' || id == 'displayHairAcc') {
            	html += '<li id="' + 'display' + '_item_' + item.itemId + '">';
            }else {
            	html += '<li id="' + key + '">';
            }
            if (id == "group-banner") {
                html += '<input type="hidden" name="itemList" value="' + item.itemId + '" />';
            } else {
            	if(id == 'displayAll' || id == 'displayJewelry' || id == 'displayBag' || id == 'displayWatch'
                    || id == 'displayOutlet' || id == 'displayExclusive' || id == 'displayHairAcc') {
            		html += '	<input type="hidden" name="' + 'display' + 'ItemIds" value="' + item.itemId + '" />';
                }else {
                	html += '	<input type="hidden" name="' + id + 'ItemIds" value="' + item.itemId + '" />';
                }
            }
            html += '	<p class="image"><img src="' + item.itemImage + '" class="item_image size-100 none" alt="상품이미지" /></p>';
            html += '    <p class="title">[' + item.itemUserCode + ']<br /> <label style="color:red">['+Common.numberFormat(item.itemPrice)+']</label>' + item.saleStatus + '<br />' + item.itemName + '</p>';
            if(id == 'displayAll' || id == 'displayJewelry' || id == 'displayBag' || id == 'displayWatch'
                || id == 'displayOutlet' || id == 'displayExclusive' || id == 'displayHairAcc') {
            	html += '	<span class="ordering">Add</span>';
            }else {
            	html += '	<span class="ordering">' + ordering + '</span>';
            }

            html += '	<a href="javascript:Shop.deleteRelationItem(\'' + key + '\')" class="delete_item_image"><img src="/content/opmanager_image/icon/icon_x.gif" alt="" /></a>';
            html += '</li>';

            $('#' + id).append(html);
        }
    }
};

// 관련상품 추가여부 확인
Shop.isAddedRelationItem = function(id, itemId) {
    var key = id + '_item_' + itemId;
    var itemCount = $('#' + key).size();
    if (itemCount == 0) {
        return false;
    }
    return true;
};

// 관련상품 삭제
Shop.deleteRelationItem = function(key) {
    $('#' + key).remove();
};

//관련상품 삭제
Shop.deleteRelationItemAll = function(targetId) {
    $('#' + targetId).find('li').remove();
};

Shop.isAvilableRelatedItemCount = function(targetId) {
    var count = $('#' + targetId).find('li').size();
    if (count > 1) { // 관련상품은 1개 이상 등록 불가 hschoi 처음엔 6개였음.
        return false;
    }
    return true;
}

Shop.isAvilableItemCount = function(targetId, limit) {
    var count = $('#' + targetId).find('li').size();
    if (count >= limit) {
        return false;
    }
    return true;
}

// 회원만 상세페이지 접속 가능.
Shop.loginToItemDetailPage = function(itemUserCode) {
    var message = Message.get("M00775") + '\n' + Message.get("M00602"); // 로그인 후 확인이 가능합니다.\n 로그인 페이지로 이동하시겠습니까?
    if (confirm(message)) {
        location.href = "/users/login?target=/products/view/" + itemUserCode;
    }
};

var ShopEventHandler = {};

/**
 * 팀/그룹 > 1차 > 2차 > 3차 > 4차 셀렉트 박스 선택 이벤트
 */
var CURRENT_SELECT_CATEGORY_LEVEL;
ShopEventHandler.categorySelectboxChagneEvent = function() {

    if ($('#categoryGroupId').size() > 0) {
        // 카테고리 그룹 선택
        $('#categoryGroupId').on('change', function() {
            var categoryGroupId = $(this).val();
            $('#categoryId').val("");
            Shop.getCategoriesByCategoryGroupId(categoryGroupId, "");
        });

        // 1차 카테고리 목록 조회 (by categoryGroupId)
        Shop.getCategoriesByCategoryGroupId = function(categoryGroupId, categoryClass1) {
            Common.loading.display = false;
            $.post('/categories/options-by-groupid', { 'categoryGroupId': categoryGroupId, 'categoryClass1': categoryClass1 }, function(response) {
                var optionTitles = [];

                for (var i = 1; i <= 4; i++) {
                    optionTitles[i] = '<option value="">= ' + i + Message.get("M00075") + ' =</option>'; // {}차 카테고리
                }

                $('select.category:not(#categoryGroupId)').empty().each(function(i) {
                    $(this).append(optionTitles[i + 1]);
                });
                $('#categoryClass1').append(response);
            }, 'html');
        };

        // 1~3차 카테고리 선택
        $(document).on("change", '#categoryClass1, #categoryClass2, #categoryClass3', function() {
            var categoryClass = $(this).val();
            var categoryId = $(this).find('option:selected').attr('rel');

            $('#categoryId').val(categoryId);

            CURRENT_SELECT_CATEGORY_LEVEL = $(this).attr('id').replace('categoryClass', '');
            Shop.getCategorisByCategoryClass(CURRENT_SELECT_CATEGORY_LEVEL, categoryClass, "");
        });

        Shop.getCategorisByCategoryClass = function(categoryLevel, categoryClass, categoryClass1) {
            CURRENT_SELECT_CATEGORY_LEVEL = categoryLevel;
            $.post('/categories/options', { 'categoryClass': categoryClass, 'categoryClass1': categoryClass1 }, function(response) {
                var nextCategoryLevel = Number(CURRENT_SELECT_CATEGORY_LEVEL) + 1;

                for (var i = nextCategoryLevel; i <= 4; i++) {
                    var optionTitle = '<option value="">= ' + i + '' + Message.get("M00075") + ' =</option>'; // {}차 카테고리
                    $('#categoryClass' + i).empty().append(optionTitle);
                }
                $('#categoryClass' + nextCategoryLevel).append(response);
            }, 'html');
        };

        // 카테고리 검색 활성화
        Shop.activeCategoryClass = function(categoryGroupId, categoryClass1, categoryClass2, categoryClass3, categoryClass4) {
            $.ajaxSetup({ 'async': false });
            if (categoryGroupId != '') {
                Shop.getCategoriesByCategoryGroupId(categoryGroupId, categoryClass1);
            }

            if (categoryClass1 != '') {
                Shop.getCategorisByCategoryClass("1", categoryClass1, categoryClass2);
            }

            if (categoryClass2 != '') {
                Shop.getCategorisByCategoryClass("2", categoryClass2, categoryClass3);
            }

            if (categoryClass3 != '') {
                Shop.getCategorisByCategoryClass("3", categoryClass3, categoryClass4);
            }

            $.ajaxSetup({ 'async': true });
        };
    }
};

/**
 * 팀 > 그룹 > 1차 
 */
var CURRENT_SELECT_CATEGORY_LEVEL;
ShopEventHandler.categorySelectboxChagneEvent2 = function() {
    if ($('#code').size() > 0) {
        // 카테고리 그룹 선택
        $('#code').on('change', function() {
            var teamId = $(this).val();
            Shop.getCategoriesByCategoryTeamId(teamId, "");
        });

        $('#categoryGroupId').on('change', function() {
            var categoryGroupId = $(this).val();
            $('#categoryId').val("");
            Shop.getCategoriesByCategoryGroupId(categoryGroupId, "");
        });

        // 1차 카테고리 목록 조회 (by categoryGroupId)
        Shop.getCategoriesByCategoryTeamId = function(categoryTeamId, categoryGroupId) {
            Common.loading.display = false;
            $.post('/categories/options-by-groupid2', { 'categoryTeamId': categoryTeamId, 'categoryGroupId': categoryGroupId }, function(response) {
                var optionTitles = [];
                for (var i = 1; i <= 4; i++) {
                    optionTitles[i] = '<option value="">= ' + i + Message.get("M00075") + ' =</option>'; // {}차 카테고리
                }

                $('select.category:not(#categoryGroupId)').empty().each(function(i) {
                    $(this).append(optionTitles[i + 1]);
                });
                $('#categoryGroupId').html(response);
            }, 'html');
        };

        Shop.getCategoriesByCategoryGroupId = function(categoryGroupId, categoryClass1) {
            Common.loading.display = false;
            $.post('/categories/options-by-groupid', { 'categoryGroupId': categoryGroupId, 'categoryClass1': categoryClass1 }, function(response) {
                var optionTitles = [];
                for (var i = 1; i <= 4; i++) {
                    optionTitles[i] = '<option value="">= ' + i + Message.get("M00075") + ' =</option>'; // {}차 카테고리
                }

                $('select.category:not(#categoryGroupId)').empty().each(function(i) {
                    $(this).append(optionTitles[i + 1]);
                });
                $('#categoryClass1').append(response);
            }, 'html');
        };

        // 1~3차 카테고리 선택
        $(document).on("change", '#categoryClass1, #categoryClass2, #categoryClass3', function() {
            var categoryClass = $(this).val();
            var categoryId = $(this).find('option:selected').attr('rel');

            $('#categoryId').val(categoryId);

            CURRENT_SELECT_CATEGORY_LEVEL = $(this).attr('id').replace('categoryClass', '');
            Shop.getCategorisByCategoryClass(CURRENT_SELECT_CATEGORY_LEVEL, categoryClass, "");
        });

        Shop.getCategorisByCategoryClass = function(categoryLevel, categoryClass, categoryClass1) {
            CURRENT_SELECT_CATEGORY_LEVEL = categoryLevel;
            $.post('/categories/options', { 'categoryClass': categoryClass, 'categoryClass1': categoryClass1 }, function(response) {
                var nextCategoryLevel = Number(CURRENT_SELECT_CATEGORY_LEVEL) + 1;

                for (var i = nextCategoryLevel; i <= 4; i++) {
                    var optionTitle = '<option value="">= ' + i + '' + Message.get("M00075") + ' =</option>'; // {}차 카테고리
                    $('#categoryClass' + i).empty().append(optionTitle);
                }
                $('#categoryClass' + nextCategoryLevel).append(response);
            }, 'html');
        };

        // 카테고리 검색 활성화
        Shop.activeCategoryClass2 = function(code, categoryGroupId, categoryClass1, categoryClass2, categoryClass3, categoryClass4) {
            $.ajaxSetup({ 'async': false });

            if (code != '') {
                Shop.getCategoriesByCategoryTeamId(code, categoryGroupId);
            }

            if (categoryGroupId != '') {
                Shop.getCategoriesByCategoryGroupId(categoryGroupId, categoryClass1);
            }

            if (categoryClass1 != '') {
                Shop.getCategorisByCategoryClass("1", categoryClass1, categoryClass2);
            }

            if (categoryClass2 != '') {
                Shop.getCategorisByCategoryClass("2", categoryClass2, categoryClass3);
            }

            if (categoryClass3 != '') {
                Shop.getCategorisByCategoryClass("3", categoryClass3, categoryClass4);
            }

            $.ajaxSetup({ 'async': true });
        };
    }
};

function seoCopy($event) {
    var flag = $event.attr("id");
    var inputName = $event.prev().attr("name");
    var inputName2 = $event.prev().attr("name").replace("rankSeo", "categoriesSeo").replace("reviewSeo", "categoriesSeo");
    switch (flag) {
        case "rank_title":
        case "rank_headercontents":
        case "rank_themawordtitle":
            $("input[name='" + inputName + "']").val($("input[name='" + inputName2 + "']").val().replace("通販", "売れ筋人気ランキング"));
            break;
        case "rank_keyword":
            $("input[name='" + inputName + "']").val($("input[name='" + inputName2 + "']").val().replace("通販", "売れ筋,人気,ランキング"));
            break;

        case "rev_title":
        case "rev_headercontents":
        case "rev_themawordtitle":
            $("input[name='" + inputName + "']").val($("input[name='" + inputName2 + "']").val().replace("通販", "口コミ・レビュー"));
            break;
        case "rev_keyword":
            $("input[name='" + inputName + "']").val($("input[name='" + inputName2 + "']").val().replace("通販", "口コミ,レビュー"));
            break;
    }
}

/**
 * 해당 차수에 child category의 옵션을 가져온다.
 * 파라미터가 없으면 : TEAM 목록
 * categoryTeamCode : GROUP 목록 
 * categoryGroupCode : 1차 카테고리 목록 
 * categoryUrl : 하위 카테고리 목록.
 * 
 * @param param object = {'categoryTeamCode' : '', categoryGroupCode : '', categoryUrl : '', categoryCode: ''} // categoryCode ==> 활성화 코드.(selected="selected")
 * @param string options Html
 * @return
 */
Shop.getChildCategoryOptionsByCode = function(param) {
    var result = '';
    $.ajaxSetup({ 'async': false });

    $.post('/categories/options-by-category-code', param, function(response) {
        result = response;
    }, 'html');

    $.ajaxSetup({ 'async': true });

    return result;
};

// 상품 목록에서 장바구니 담기.
Shop.addToCartReload = function(itemId, orderMinQuantity, nonmemberOrderType, isLogin, target, itemType, isAlert) {
    var quantity = Number(orderMinQuantity) > 1 ? Number(orderMinQuantity) : 1;
    
    if(isAlert == null || isAlert == undefined){
        isAlert = true;
    }
    
    /*if(!Shop.checkedBusinessItem(itemType, businessFlag)){
    	return;
    }*/
    
    if (isLogin == 'false' && nonmemberOrderType == '2') {
        var message = Message.get("M00601") + '\n' + Message.get("M00602"); // 회원만 구매가 가능합니다. 로그인 페이지로 이동하시겠습니까?
        if (confirm(message)) {
            location.href = Shop.url('/users/login?target=' + target);
        }
        return false;
    }
    
    var param = {
        'arrayRequiredItems': itemId + '||' + quantity + '||' + ' ' + '||' + '0' + '||' + '0'
    };

    if(itemId == '24455'){
        if (isLogin == 'false') {
            var message = Message.get("M00601") + '\n' + Message.get("M00602"); // 회원만 구매가 가능합니다. 로그인 페이지로 이동하시겠습니까?
            if (confirm(message)) {
                location.href = Shop.url('/users/login?target=' + target);
            }
            return false;
        }else{
            var datas = {"itemId": itemId};
            $.ajax({
                type: 'post',
                url: '/order/count1700Check',
                dataType: 'json',
                data: datas,
                async: true,
                success: function (res) {
                    //주문했던 이력 조회
                    if (res.data != 0) {
                        alert('이상품은 ID당 한번만 구매가 가능합니다.');
                        return;
                    }else{
                        $.post(Shop.url('/cart/add-item-to-cart'), param, function(response) {
                            Common.responseHandler(response, function() {
                                Shop.getCartInfo();
                                if(!Shop.isMobilePage){
                                    Shop.openCartWishlistLayer('cart');
                                }else {
                                    if(isAlert){
                                        alert("상품이 쇼핑백에 담겼습니다.");
                                    }
                                }
                            });
                        }, 'json');
                    }
                },
                fail: function (err) {
                    alert('잠시후 다시 시도해주세요.');
                    return;
                }
            })
        }
    }else{
        $.post(Shop.url('/cart/add-item-to-cart'), param, function(response) {
            Common.responseHandler(response, function() {
                Shop.getCartInfo();
                if(!Shop.isMobilePage){
                    Shop.openCartWishlistLayer('cart');
                }else {
                    if(isAlert){
                        alert("상품이 쇼핑백에 담겼습니다.");
                        //location.href = "/sp/cart";
                        location.reload();
                    }
                }
            });
        }, 'json');
    }
    /*onlinepowers-20191028-end-1700*/
};

// 상품 목록에서 장바구니 담기.
Shop.addToCart = function(itemId, orderMinQuantity, nonmemberOrderType, isLogin, target, itemType, isAlert) {
    var quantity = Number(orderMinQuantity) > 1 ? Number(orderMinQuantity) : 1;
    
    if(isAlert == null || isAlert == undefined){
    	isAlert = true;
    }
    
    /*if(!Shop.checkedBusinessItem(itemType, businessFlag)){
    	return;
    }*/

    if (isLogin == 'false' && nonmemberOrderType == '2') {
        var message = Message.get("M00601") + '\n' + Message.get("M00602"); // 회원만 구매가 가능합니다. 로그인 페이지로 이동하시겠습니까?
        if (confirm(message)) {
            location.href = Shop.url('/users/login?target=' + target);
        }
        return false;
    }
    
    var param = {
        'arrayRequiredItems': itemId + '||' + quantity + '||' + ' ' + '||' + '0' + '||' + '0'
    };

    if(itemId == '24455'){
        if (isLogin == 'false') {
            var message = Message.get("M00601") + '\n' + Message.get("M00602"); // 회원만 구매가 가능합니다. 로그인 페이지로 이동하시겠습니까?
            if (confirm(message)) {
                location.href = Shop.url('/users/login?target=' + target);
            }
            return false;
        }else{
            var datas = {"itemId": itemId};
            $.ajax({
                type: 'post',
                url: '/order/count1700Check',
                dataType: 'json',
                data: datas,
                async: true,
                success: function (res) {
                    //주문했던 이력 조회
                    if (res.data != 0) {
                        alert('이상품은 ID당 한번만 구매가 가능합니다.');
                        return;
                    }else{
                        $.post(Shop.url('/cart/add-item-to-cart'), param, function(response) {
                            Common.responseHandler(response, function() {
                                Shop.getCartInfo();
                                if(!Shop.isMobilePage){
                                    Shop.openCartWishlistLayer('cart');
                                }else {
                                    if(isAlert){
                                        alert("상품이 쇼핑백에 담겼습니다.");
                                    }
                                }
                            });
                        }, 'json');
                    }
                },
                fail: function (err) {
                    alert('잠시후 다시 시도해주세요.');
                    return;
                }
            })
        }
    }else{
        $.post(Shop.url('/cart/add-item-to-cart'), param, function(response) {
            Common.responseHandler(response, function() {
                Shop.getCartInfo();
                if(!Shop.isMobilePage){
                    Shop.openCartWishlistLayer('cart');
                }else {
                    if(isAlert){
                        alert("상품이 쇼핑백에 담겼습니다.");
                    }
                }
            });
        }, 'json');
    }
    /*onlinepowers-20191028-end-1700*/
};

// 퀵 배너
Shop.getQuickBanner = function(imgUrl) {
    $.post('/common/quick-banner', '', function(response) {
    	
    	try {
            var data = response.data;

            var $linkBanner = $('.link-banner');

            for (var i = 0; i < data.length; i++) {
                // onlinepowers-20190423-start
                if (data[i].displayImage != null && data[i].displayImage != '' && data[i].displayImage != undefined) {
                    /*var list = '<a href="' + data[i].displayUrl + '"><img src="' + imgUrl + '/display/' + data[i].displayGroupCode + '/' + data[i].displaySubCode + '/default/' + data[i].displayImage + '" alt="" style="width:110px; height: 100px;"></a>';*/
                    var list = '<a href="' + data[i].displayUrl + '"><img src="' + imgUrl + '/display/' + data[i].displayGroupCode + '/' + data[i].displayImageSeq + '/thumb/' + data[i].displayImage + '" alt="" style="width:110px; height: 100px;"></a>';
                    
                    $linkBanner.append(list);
                }
                // onlinepowers-20190423-end
            }
    	} catch(e) {}
    });
}

//오늘 본 상품 조회 
Shop.getTodayItems = function() {
    Common.loading.display = false;
    var $todayItems = $('.op-today-items');
//    if ($todayItems.size() == 0) {
    if ($todayItems.length == 0) {
        return;
    }

    $.post('/common/today-items', {}, function(response) {
        Common.responseHandler(response, function(response) {
            var items = response.data;

            if (items != null) {
                if (items.length > 0) {
                    var html = '';

                    html += '	<a href="#" class="button-lately">최근 본 상품 <span>' + items.length + '</span></a>';
                    html += '	<div class="lately-item">';
                    html += '	    <span class="layer-tail"></span>';
                    html += '		<div class="lately-tit">';
                    html += '           <strong>최근 본 상품</strong>';
                    html += '           <a href="#" class="lately-close"><img src="/content/image/btn/btn_lately_close.png" alt=""></a>';
                    html += '       </div>';
                    html += '       <div class="lately-cont">';
                    html += '           <div class="swiper-container lately-swiper-container swiper-container-horizontal swiper-container-multirow">';
                    html += '               <div class="swiper-wrapper" style="width: 720px;">';

                    var j = 1;
                    for (var i = 0; i < items.length; i++) {
                        var item = items[i];

                        html += '                   <div class="swiper-slide swiper-slide' + (j++) + '">';
                        html += '                       <div class="lately-img">';
                        html += '                           <a href="/products/view/' + item.itemUserCode +'"><img src="' + item.itemImage + '" alt="' + item.itemName +'" width="100px"></a>';
                        html += '                       </div>';
                        html += '                   </div>';
                    }

                    html += '               </div>';
                    html += '           </div>';
                    html += '           <div class="layer-pagination">';
                    html += '               <a href="#" class="btn-prev swiper-button-disabled"><img src="/content/image/btn/btn_lately_prev.png"></a>';
                    /*html += '               <div class="pagination swiper-pagination-clickable swiper-pagination-bullets"><span class="swiper-pagination-bullet" ></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span></div>';*/
                    html += '               <div class="pagination swiper-pagination-clickable swiper-pagination-bullets"></div>';
                    html += '               <a href="#" class="btn-next"><img src="/content/image/btn/btn_lately_next.png"></a>';
                    html += '           </div>';
                    html += '       </div>';
                    html += '   </div>';

                    $todayItems.html(html);

                    try {
                        Shop.quickMenuPagination(items.length);
                        startTodayItemSwiper();
                    } catch (e) {

                    }
                }
            }
        });
    });
};

//오늘 본 상품 조회 
Shop.getMobileTodayItems = function() {
    Common.loading.display = false;
    var $todayItems = $('.op-today-items');
    if ($todayItems.size() == 0) {
        return;
    }

    $.post('/common/today-items', {}, function(response) {
        Common.responseHandler(response, function(response) {
            var items = response.data;

            if (items != null) {
                if (items.length > 0) {
                    var html = '';
                    html += '	<div class="title"><h2>오늘 본 상품</h2></div>';
                    html += '		<div class="viewed_list">';
                    html += '			<ul>';
                    for (var i = 0; i < items.length; i++) {
                        if (i > 2) {
                            break;
                        }

                        var item = items[i];
                        var itemName = item.itemName;
                        if (itemName.length > 25) {
                            itemName = itemName.substring(0, 25) + '..';
                        }

                        html += '			<li>';
                        html += '				<div class="img"><a href="' + item.link + '"><img src="' + item.imageSrc + '" alt="item1" /></a></div>'
                        html += '				<div class="txt">';
                        html += '					<a href="' + item.link + '">';
                        html += '						<p class="name">' + itemName + '</p>';
                        html += '						<p class="price">' + Common.numberFormat(item.exceptUserDiscountPresentPrice) + '원</p>';
                        html += '					</a>';
                        html += '				</div>';
                        html += '			</li>';
                    }
                    html += '			</ul>';
                    html += '		</div>';

                    $todayItems.html(html);
                }
            }
        });
    });

};

// 상품목록에서 관심상품 담기
Shop.addToWishList = function(itemId, orderMinQuantity, isLogin, target, wishlistGroupId, itemType) {
    var quantity = Number(orderMinQuantity) > 1 ? Number(orderMinQuantity) : 1;

    /*if(!Shop.checkedBusinessItem(itemType, businessFlag)){
    	return;
    }*/

    if (isLogin == 'false') {
        var message = "관심상품 등록은 회원만 가능합니다." + '\n' + Message.get("M00602"); // 관심상품 등록은 회원만 가능합니다. 로그인 페이지로 이동하시겠습니까?
        if (confirm(message)) {
            location.href = Shop.url('/users/login?target=' + target);
        }
        return false;
    }
    var param = {
        'arrayItemId': itemId,
        'arrayQuantitys': quantity,
        'arrayRequiredOptions': '',
        'arraySelectionOptions': '',
        'wishlistGroupId': wishlistGroupId
    };

    $.post(Shop.url('/wishlist/add'), param, function(response) {
        Common.responseHandler(response, function() {

            // Shop.getCartInfo();

            Shop.openCartWishlistLayer('wishlist');

        });
    }, 'json');
};

Shop.checkedBusinessItem = function(itemType, businessFlag) {
    if (itemType == "2" && businessFlag != "Y") {
        alert("사업자회원만 구매 가능합니다.");
        return false;
    } else {
        return true;
    }
}

//상품 목록에서 입하소식신청.
Shop.applyForArrival = function(itemId, isLogin, target) {
    // 1. 로그인 체크
    if (isLogin == 'false') {
        alert('ログインしてください。');
        location.href = Shop.url('/users/login?target=' + target);
        return;
    }

    // 2. 신청 처리
    var param = {
        'itemId': itemId,
        'itemOptionIds': ''
    };

    $.post(Shop.url('/resale/apply-for-arrival'), param, function(response) {
        Common.responseHandler(response, function() {
            var message = Message.get("M00598") + '\n' + Message.get("M00596"); // 입하 소식을 신청했습니다. 바로 확인하시겠습니까?
            if (confirm(message)) {
                location.href = Shop.url("/mypage/resale");
            }
        });
    });
};

//관심 상품수 조회
Shop.getWishlistCount = function() {
    if ($('#header_wish_quantity') == undefined) {
        return;
    }

    $.post('/common/wishlist', {}, function(response) {
        Common.responseHandler(response, function(response) {
            var count = response.data;
            if (count > 0) {
                $('#header_wish_quantity').text(Common.numberFormat(count));
            }
        });
    }, 'json');
};

//상품별 관심수 조회 및 표기
Shop.getWishlistCountByItem = function(itemId) {
    // 관심상품 아이콘이 없으면 생성
    if ($('.product-detail-main__btn-like-text').attr('id') == undefined) {
        $('.product-detail-main__btn-like-wrap .product-detail-main__btn-like').addClass('product-detail-main__btn-like--active');
        $('.product-detail-main__btn-like-wrap').append('<p id="itemLikeCount" class="product-detail-main__btn-like-text"></p>');
    }

    $.post('/common/wishlistCountByItem', {'itemId': itemId}, function(response) {
        Common.responseHandler(response, function(response) {
            var count = response.data;
            if (count > 0) {
                $('.product-detail-main__btn-like-text').text(Common.numberFormat(count));
            } else {    // 관심상품수가 없으면 요소 삭제
                $('.product-detail-main__btn-like-wrap .product-detail-main__btn-like').removeClass('product-detail-main__btn-like--active');
                $('.product-detail-main__btn-like-text').remove();
            }
        });
    }, 'json');
};

//장바구니 정보 조회 
Shop.getCartInfo = function() {
//	console.log('Shop.getCartInfo');
    Common.loading.display = false;
    $.post('/common/cart', {}, function(response) {
        Common.responseHandler(response, function(response) {
            var obj = response.data;
            var quantity = obj.cartList.length;
            
            if ($('#quick-menu').length > 0) {
                $('#aside_cart_quantity').text(Common.numberFormat(quantity));
                $('#header_cart_quantity').text(Common.numberFormat(quantity));
                $('#lnb_cart_quantity').text(Common.numberFormat(quantity));
                $('#header_cart_quantity').addClass('header__btn--cart-badge');
                $('#lnb_cart_quantity').addClass('header__btn--cart-badge');
            } else {
                if (quantity > 0) {
                    $('#header_cart_quantity').text(Common.numberFormat(quantity)).show();
                    $('#footer_cart_quantity').text(Common.numberFormat(quantity)).show();
                    $('#lnb_cart_quantity').text(Common.numberFormat(quantity)).show();
                    $('#header_cart_quantity').addClass('header__btn--cart-badge');
                    $('#lnb_cart_quantity').addClass('header__btn--cart-badge');
                }
            }
        });
    }, 'json');

};

Shop.getTodayItemsCount = function() {
    Common.loading.display = false;
    $.post('/common/today-items-count', {}, function(response) {
        Common.responseHandler(response, function(response) {
            var count = response.data;
            if (count > 0) {
                $('.footer-dockbar__history-badge').text(count >= 99 ? '99+' : count);
                $('.footer-dockbar__history-badge').show();
            } else {
                $('.footer-dockbar__history-badge').hide();
            }
        });
    }, 'json');
};

// 상품 목록에서 상세페이지로 이동.
Shop.goItemDetails = function(itemUserCode, nonmemberOrderType, isLogin) {
    if (nonmemberOrderType == '3' && isLogin == 'false') {
        Shop.loginToItemDetailPage(itemUserCode);
    } else {
        location.href = Shop.url('/products/view/' + itemUserCode);
    }
};

Shop.closeOrderLayer = function(type) {
    $('#layer_' + type).hide();
    Common.dimmed.hide();
};

// 장바구니 / 위시리스트 확인창 열기 
Shop.openCartWishlistLayer = function(type) {
	console.log('Shop.openCartWishlistLayer - type : ' + type);
    Common.dimmed.show();

    var layerCartHtml = $('#op-layer-' + type).htmlWithParent();
    $('#op-layer-' + type).remove();
    $('body').append(layerCartHtml);
    $('#op-layer-' + type).show();
};

//장바구니 / 위시리스트 확인창 닫기 
Shop.closeCartWishlistLayer = function() {
    $('#op-layer-wishlist, #op-layer-cart').hide();
    Common.dimmed.hide();
    //모바일에서 위시리스트 백그라운드 닫기
    $('.layer_pop_bg').hide();
};

// [모바일] 팀, 그룹, 카테고리 페이지의 '카테고리에서 찾기'
Shop.findCategory = function() {
    // 카테고리 검색 (하위 카테고리 목록)
    var $category = $('.category_depth01 > li > a');
    if ($category.size() > 0) {
        $category.on('click', function(e) {
            var hasChildCategories = $(this).next().size() > 0 ? true : false;

            if (hasChildCategories) {
                e.preventDefault();

                var $parent = $(this).parent();
                var isActive = $parent.hasClass('on');

                $(this).closest('ul').find(' > li').removeClass('on');
                if (!isActive) {
                    $parent.addClass('on');
                }
            }

        });
    }
};

Shop.setHeightOfItemList = function(selector) {
    var $selector = $(selector);
    var h = $selector.height() - 2;
    $selector.css({ 'overflow': 'hidden', 'height': h + 'px' });
};

// breadcrumbs select.team
Shop.showAllCategoriesLayer = function() {
    if ($('#op-all-menus').css('display') == 'none') {
        $('#op-all-menu-button').addClass('on');
        $("#op-all-menus").addClass('show');
    } else {
        Shop.hideAllCategoriesLayer();
    }

    $("#op-all-menus").focus();
};

Shop.hideAllCategoriesLayer = function() {
    $('#op-all-menu-button').removeClass('on');
    $("#op-all-menus").removeClass('show');
    $("#op-all-menus").focus();
};

/**
 * 방문자 접속 통계를 저장.
 */
Shop.writeVisitorLog = function() {
    if ($.cookie('IS_VISITED') != "1") {
        $.post('/common/visitor-log', {}, function() {

        });
    }
};

Shop.quickMenuPagination = function(todayItemCount) {
    // QUICK MENU
    var $quickMenu = $('#quick-menu');
    var $todayItems = $('.swiper-wrapper');
    var todayItemsIndex = 0;
    var itemHeight = 58;
    var itemsPerPage = 6;
    var totalPages = Math.ceil(todayItemCount / itemsPerPage);
    var currentPage = 1;

    /*$quickMenu.find('.swiper-wrapper').css('height', itemHeight * (itemsPerPage < todayItemCount ? itemsPerPage : todayItemCount));*/
    /*$quickMenu.find('.page p span').text(totalPages);*/
    // 메인화면 목록 동그라미 계속생겨서 주석 19-01-24 rbxo01
/*    if (todayItemCount > 0) {
        var list = "";
        var j = 1;
        for (var i = 0; i < totalPages; i++) {
            list += '<span class="swiper-pagination-bullet" data-page="' + (j++) + '"></span>';
            list += '<span class="swiper-pagination-bullet" data-page="' + (j++) + '" "></span>';
        }
        $('.pagination').append(list);
    }
*/

    $('.swiper-pagination-bullet').on('click', function() {
        var pageNumber = $(this).data('page');

    });

    $('.page a.prev').on('click', function(e) {
        e.preventDefault();

        if (totalPages > 1) {
            if (currentPage == 1) {
                currentPage = totalPages;
            } else {
                currentPage--;
            }

            var topSize = (currentPage - 1) * itemHeight * itemsPerPage;
            $todayItems.css('margin-top', '-' + topSize + 'px');
            /*$quickMenu.find('.layer-pagination p strong').text(currentPage);*/
        }

    });

    $('.page a.next').on('click', function(e) {
        e.preventDefault();

        if (totalPages > 1) {
            if (currentPage == totalPages) {
                currentPage = 1;
            } else {
                currentPage++;
            }

            var topSize = (currentPage - 1) * itemHeight * itemsPerPage;
            $todayItems.css('margin-top', '-' + topSize + 'px');
            $quickMenu.find('.page p strong').text(currentPage);
        }

    });

    // QUICK MENU
    /*var $quickMenu = $('#quick-menu');
    var $todayItems = $('.item_area ul');
    var todayItemCount = $todayItems.find('> li').size();
    var todayItemsIndex = 0;
    var itemHeight = 58;
    var itemsPerPage = 3;
    var totalPages = Math.ceil(todayItemCount / itemsPerPage);
    var currentPage = 1;

    $quickMenu.find('.item_area').css('height', itemHeight * (itemsPerPage < todayItemCount ? itemsPerPage : todayItemCount));

    $quickMenu.find('.page p span').text(totalPages);

    $('.page a.prev').on('click', function(e) {
        e.preventDefault();

        if (totalPages > 1) {
            if (currentPage == 1) {
                currentPage = totalPages;
            } else {
                currentPage--;
            }

            var topSize = (currentPage - 1) * itemHeight * itemsPerPage;
            $todayItems.css('margin-top', '-' + topSize + 'px');
            $quickMenu.find('.page p strong').text(currentPage);
        }



    });

    $('.page a.next').on('click', function(e) {
        e.preventDefault();

        if (totalPages > 1) {
            if (currentPage == totalPages) {
                currentPage = 1;
            } else {
                currentPage++;
            }

            var topSize = (currentPage - 1) * itemHeight * itemsPerPage;
            $todayItems.css('margin-top', '-' + topSize + 'px');
            $quickMenu.find('.page p strong').text(currentPage);
        }

    });*/
};

//장바구니 정보 조회 
Shop.getCouponInfo = function() {
    Common.loading.display = false;
    $.post('/common/coupon', {}, function(response) {
        Common.responseHandler(response, function(response) {
            var obj = response.data;

            if ($('#aside_coupon_count').size() > 0) {
                $('#aside_coupon_count').text(Common.numberFormat(obj.userCouponCount));
            }

            if ($('#aside_shipping_coupon_count').size() > 0) {
                $('#aside_shipping_coupon_count').text(Common.numberFormat(obj.userShippingCount));
            }
        });
    }, 'json');
};

Shop.procSessionTimeout = function() {
    if (OP_USER_TIMEOUT == '') {
        return;
    }

    var timeout = Number(OP_USER_TIMEOUT) * 60 * 1000;

	setTimeout(function () {
		if (Shop.isMobilePage) {
			location.href = '/op_security_logout?target=/sp';
		} else {
			location.href = '/op_security_logout?target=/';
		}
	}, timeout);
}

Shop.activeMyPageLnb = function (lnbId) {
	if (lnbId == '') {
		return;
	}

	$object = $('#'+lnbId);
	if ($object.length > 0) {
		$object.addClass('on');

		$('.mypage-lnb-depth2').each(function() {
			$(this).removeClass('on');
			if ($(this).find('li').hasClass('on')) {
				$(this).addClass('on');
			}
		});
	}
}

Shop.openPopup = function(id, popupClass) {
    var $object = $('#'+id);
    if($object.length > 0) {
	    var layerHeight = $object.height();

        if (popupClass != '') {
	        $object.addClass(popupClass);
	        layerHeight = $('.'+popupClass).height();
        }

        var positionTop = $(window).scrollTop() + ($(window).height() - layerHeight)/2;
        console.log('positionTop : ' + positionTop);
	    $object.css({top: positionTop < 0 ? 0 : positionTop});

        $object.show();
	    $('.dimmed').show();
    }
}

Shop.closePopup = function(id, popupClass) {
	var $object = $('#'+id);
	if($object.length > 0) {
		if (popupClass != '') {
			$object.removeClass(popupClass);
		}

		$object.hide();

		$object.removeClass().addClass('layer-popup');
		$object.find('.popup-area').removeClass().addClass('popup-area');

		$('.dimmed').hide();
	}
}

Shop.getCodeList = function(codeType, upId) {
    var url = '/common/code-list';

	if (upId == null || typeof(upId) == 'undefined' || upId == "") {
		upId = "";
    }

    var list = {};

	try {
	    var param = {
	        'codeType' : codeType,
            'upId' : upId
        }

        $.ajax({
	        url : url,
	        async : false,
	        type : 'POST',
	        data : param,
	        success : function(response) {
		        Common.responseHandler(response, function(response) {
			        list = response.data;
		        });
	        },
	        error : function() {
	        	console.log('ajax 통신 에러');
	        }
        });

    } catch (e) {}
    return list;
}

Shop.closeBandBanner = function() {
    // 닫기 버튼 눌렀을 때 1일간 안보이기
    var expire = new Date();
    var cookieName = "close-one-day-band-banner";

    expire.setDate(expire.getDate() + 1);

    document.cookie = cookieName + "=1; expires=" + expire.toString() +"; path=/";

    $('.top-line-banner-t').css('display', 'none');
}

Shop.closeMobileBandBanner = function() {
    var hdr = $('.header');
    $('.prm .cls').on('click', () => {
        $('.prm').css({'display': 'none'})
        $('.contents').css({'padding-top': hdr.outerHeight(true) + 'px'})

        // $('.mobile-top-line-banner-t').css('display', 'none');

        // 닫기 버튼 눌렀을 때 1일간 안보이기
        var expire = new Date();
        var cookieName = "close-one-day-mobile-band-banner";

        expire.setDate(expire.getDate() + 1);

        document.cookie = cookieName + "=1; expires=" + expire.toString() +"; path=/";
    });
}

Shop.eventMobileBodyFix = function() {
    $('#wrap').addClass('view-fix');
    $('body').addClass('view-fix');
}

Shop.eventMobileBodyMove = function() {
    $('#wrap').removeClass('view-fix');
    $('body').removeClass('view-fix');
}

Shop.showMobileLayerPopup = function(title, popupClass) {
    var $popup = $('#layerPopupArea');
    if ($popup.length > 0) {
        if (typeof title != 'undefined' && title != '') {
            $('#layerPopupTitle').text(title);
        }

	    if (typeof popupClass != 'undefined' && popupClass != '') {
		    $popup.addClass(popupClass);
	    }

        Shop.eventMobileBodyFix();
	    $popup.show();
    }
}

Shop.closeMobileLayerPopup = function() {
	var $popup = $('#layerPopupArea');
	if ($popup.length > 0) {
		$popup.hide();
		Shop.eventMobileBodyMove();
        $popup.removeClass().addClass('layer-popup');
		//$('#layerPopupContainer').css('overflow', 'hidden');

		$('#layerPopupContainer').empty();
	}
}

Shop.showStoreInquiry = function() {
    var area = $('#store-inquiry-form');
    if (area.length > 0) {
        $.get('/store-inquiry/inquiry', null, function(response) {
            area.empty();
            area.html(response);

            // 입점문의 팝업
            $('.dimmed').show();
            $('.Store-popup').show().css({top: $(window).scrollTop() + ($(window).height() - $('.Store-popup').height())/2});
        }, 'html');
    }
}

Shop.showAppDownload = function() {
    var appDownloadForm = $('#app-download-form');
    if (appDownloadForm.length > 0) {
        $.get('/app-download-form', null, function (response) {
            // console.log("responseData: ", response);

            appDownloadForm.empty();
            appDownloadForm.append(response);

            $('.dimmed').show();
            $('.appdownload-popup').show().css({top: $(window).scrollTop() + ($(window).height() - $('.appdownload-popup').height()) / 2});
        }, 'html');
    }
}

Shop.showMobileSearchPopup = function() {
    var $popup = $('#searchPopupArea');
    if ($popup.length > 0) {

        $.post('/sp/search', null, function (response) {
            $('#searchPopupContainer').empty();
            $('#searchPopupContainer').append(response);
            Shop.eventMobileBodyFix();
            $popup.show();
        },'html');
    }
}

Shop.procSearchPopup = function() {
    var $popup = $('#searchPopupArea');
    if ($popup.length > 0) {
        var $form = $popup.find('#searchForm'),
        query = $form.find('input[name=query]');

        $.post('/sp/search-result', $form.serialize(), function (response) {
            $('#searchPopupContainer').empty();
            $('#searchPopupContainer').append(response);
            Shop.eventMobileBodyMove();
            $popup.show();
        },'html');
    }
}

Shop.closeMobileSearchPopup = function() {
    var $popup = $('#searchPopupArea');

    if ($popup.length > 0) {
        $popup.hide();
        Shop.eventMobileBodyMove();
       $('#searchPopupContainer').empty();
    }
}

Shop.getCategoryGroupInfoListByBrandId = function(brandId) {
    var url = '/common/inquiry-category-list';
    var list = {};

    try {
        var param = {
            'brandId' : brandId
        }

        $.ajax({
            url : url,
            async : false,
            type : 'POST',
            data : param,
            success : function(response) {
                Common.responseHandler(response, function(response) {
                    list = response.data;
                });
            },
            error : function() {
                console.log('ajax 통신 에러');
            }
        });
    } catch (e) {}
    return list;
}

Shop.goToLink = function(url) {
    if (typeof url == 'undefined' || url == '') {
        history.back();
    } else {
        location.href = unescape(url);
    }
}